<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
  <title>Peta Lot</title>
  <link rel="stylesheet" href="css/leaflet.css">
  <link rel="stylesheet" href="css/qgis2web.css">
  <link rel="stylesheet" href="css/fontawesome-all.min.css">
  <style>
    html, body, #map { height: 100%; margin: 0; }

    /* Responsive Design untuk Mudah Alih */
    @media (max-width: 768px) {
      #map {
        height: 100vh; /* Pastikan peta mengisi keseluruhan skrin */
      }
      #filterContainer {
        width: 100%;
        position: relative;
        top: 10px;
        left: 0;
        padding: 8px;
        font-size: 12px;
      }
      #filterContainer button {
        font-size: 12px;
      }
      #pageHeader .logoRow img {
        width: 150px;
      }
      #pageHeader {
        padding: 8px;
        font-size: 14px;
      }
      #pageHeader h2 {
        font-size: 18px;
      }
    }

    @media (max-width: 480px) {
      #filterContainer {
        font-size: 11px;
      }
      #filterContainer input, #filterContainer select, #filterContainer button {
        font-size: 11px;
        padding: 4px;
      }
    }

    /* Style untuk welcome popup */
    #welcomePopup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .popupContent {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
      text-align: center;
      max-width: 400px;
    }

    .popupContent h3 {
      margin-top: 0;
    }

    .popupContent button {
      margin-top: 15px;
      padding: 8px 16px;
      font-size: 14px;
      background: #004466;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Header Page */
    #pageHeader {
      width: 100%;
      background: #004466;
      color: white;
      padding: 10px 20px;
      font-family: sans-serif;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    #pageHeader .logoRow {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    #pageHeader img {
      height: 50px;
    }

    /* Filter Container */
    #filterContainer {
      position: absolute;
      z-index: 999;
      background: #fff;
      padding: 10px;
      top: 140px;
      left: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      font-family: sans-serif;
      width: 250px;
      font-size: 13px;
    }

    #filterContainer input, #filterContainer select, #filterContainer button {
      width: 100%;
      margin-bottom: 8px;
      padding: 5px;
      box-sizing: border-box;
      font-size: 13px;
    }

    #filterContainer button.toggle-active {
      background: #8bc34a;
      color: white;
    }
  </style>
</head>
<body>

<!-- Welcome Popup -->
<div id="welcomePopup">
  <div class="popupContent">
    <img src="img/logo.png" alt="Logo" style="width: 300px; height: auto; margin-bottom: 15px;">
    <h3>Selamat Datang!</h3>
    <p>Ini adalah sistem maklumat lot tanah bagi Mukim Tangkak, Daerah Tangkak, Johor.</p>
    <button onclick="closePopup()">Masuk</button>
  </div>
</div>

<!-- Page Header -->
<div id="pageHeader">
  <div class="logoRow">
    <img src="img/logo.png" alt="Logo" style="width: 200px; height: auto; margin-bottom: 15px;">
    <div>
      <h2 style="margin: 0; font-size: 20px;">SISTEM MAKLUMAT LOT TANAH</h2>
      <small style="font-size: 13px;">Mukim Tangkak, Daerah Tangkak, Johor</small>
    </div>
  </div>
</div>

<!-- Filter Container -->
<div id="filterContainer">
  <div style="font-weight: bold; margin-bottom: 10px; text-align: center;">
    üóÇÔ∏è Carian & Penapisan Lot Tanah
  </div>

  <label for="mukimFilter">Tapis Mukim:</label>
  <select id="mukimFilter" onchange="enableLotSearch()">
    <option value="">-- Semua Mukim --</option>
  </select>

  <label for="lotInput">No. Lot:</label>
  <input type="text" id="lotInput" placeholder="Contoh: 11462" disabled>
  <button id="searchLotButton" onclick="highlightLot()" disabled>Cari Lot</button>

  <label for="nameInput">Nama:</label>
  <input type="text" id="nameInput" placeholder="Contoh: AIN">
  <button onclick="highlightByName()">Cari Nama</button>

  <button onclick="clearSelection()">Clear Selected</button>
  <button onclick="zoomToFullExtent()">Zoom Full Extent</button>
  <button onclick="resetMukim()">Reset Mukim</button>

  <hr>
  <label>Toggle Layers:</label>
  <button onclick="toggleLayer('LOT_0', this)">Toggle LOT 0</button>
  <button onclick="toggleLayer('TANDA', this)">Toggle LOT 1</button>
</div>

<!-- Map Container -->
<div id="map"></div>

<script src="js/leaflet.js"></script>
<script src="data/LOT_0.js"></script>
<script src="data/TANDA.js"></script>

<script>
  function closePopup() {
    document.getElementById("welcomePopup").style.display = "none";
  }

  const map = L.map('map', {
    center: [2.1025, 102.523],
    zoom: 17,
    zoomControl: false
  });

  const openStreetMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(map);

  const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles ¬© Esri'
  });

  const baseMaps = {
    "OpenStreetMap": openStreetMap,
    "Satelit (ESRI)": satellite
  };

  const layerGroup = L.layerGroup().addTo(map);
  const fullFeatures = [];

  function styleFeatureLot() {
    return {
      color: '#228B22',
      weight: 1,
      fillColor: '#B0E57C',
      fillOpacity: 0.7,
    };
  }

  const layer_LOT_0 = L.geoJSON(json_LOT_0, {
    style: styleFeatureLot,
    onEachFeature: handleFeature
  });

  function styleFeatureTandaPoint(feature, latlng) {
    return L.circleMarker(latlng, {
      radius: 5,
      color: '#00008B',
      weight: 1,
      fillColor: '#0000FF',
      fillOpacity: 0.7
    });
  }

  const layer_LOT_1 = L.geoJSON(json_TANDA, {
    pointToLayer: styleFeatureTandaPoint,
    onEachFeature: handleFeature
  });

  function handleFeature(feature, layer) {
    fullFeatures.push({ feature, layer });

    let popup = "";

    if (feature.geometry.type === "Point") {
      popup = `
        <strong>TANDA (Point)</strong><br>
        ID: ${feature.properties.ID || 'N/A'}<br>
        Koordinat: ${feature.properties.X || 'N/A'}, ${feature.properties.Y || 'N/A'}<br>
        Mukim: ${feature.properties.Mukim || 'N/A'}
      `;
    } else {
      popup = `
        <strong>LOT (Polygon)</strong><br>
        No. Lot: ${feature.properties.LOT_NO || 'N/A'}<br>
        Mukim: ${feature.properties.Mukim || 'N/A'}
      `;
    }

    layer.bindPopup(popup);
  }

  function enableLotSearch() {
    const mukimFilter = document.getElementById("mukimFilter").value;
    const lotInput = document.getElementById("lotInput");

    lotInput.disabled = !mukimFilter;
    document.getElementById("searchLotButton").disabled = !lotInput.disabled;
  }

  function toggleLayer(layerName, button) {
    const currentLayer = (layerName === "LOT_0") ? layer_LOT_0 : layer_LOT_1;
    if (map.hasLayer(currentLayer)) {
      map.removeLayer(currentLayer);
      button.classList.remove("toggle-active");
    } else {
      map.addLayer(currentLayer);
      button.classList.add("toggle-active");
    }
  }

  function highlightLot() {
    // Logika carian berdasarkan no. lot
  }

  function highlightByName() {
    // Logika carian berdasarkan nama
  }

  function clearSelection() {
    // Clear pilihan pengguna
  }

  function zoomToFullExtent() {
    map.fitBounds(layerGroup.getBounds());
  }

  function resetMukim() {
    // Reset peta berdasarkan mukim yang dipilih
  }
</script>

</body>
</html>
